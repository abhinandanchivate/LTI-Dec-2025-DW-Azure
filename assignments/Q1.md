

---

# ðŸš— PySpark Case Study â€“ Advanced Vehicle Analytics

You are given a **vehicle sales DataFrame** containing information about different car models sold by various manufacturers.

---

## ðŸ“Š Dataset Columns

| Column Name      | Data Type |
| ---------------- | --------- |
| maker            | String    |
| model            | String    |
| manufacture_date | Date      |
| units_sold       | Integer   |
| mileage          | Float     |
| price            | Integer   |
| status           | String    |

---

## âœ… Function Specifications

---

### **1. Function: create_vehicle_schema_and_load**

**Parameters**

* spark: SparkSession

**Returns**

* DataFrame

**Description**

* Define a schema and load **inline vehicle data (minimum 8 records)**.
* `manufacture_date` must be `DateType`.

**Function Signature**

```python
def create_vehicle_schema_and_load(spark: SparkSession) -> DataFrame:
```

**Expected Output**

```
DataFrame with vehicle data loaded using schema
```

---

### **2. Function: filter_active_and_recent_vehicles**

**Parameters**

* df: DataFrame
* year_limit: int

**Returns**

* DataFrame

**Description**

* Filter vehicles:

  * status = "active"
  * manufacture year >= year_limit

**Function Signature**

```python
def filter_active_and_recent_vehicles(df: DataFrame, year_limit: int) -> DataFrame:
```

**Expected Output**

```
Filtered DataFrame
```

---

### **3. Function: top_n_brands_by_revenue**

**Parameters**

* df: DataFrame
* n: int

**Returns**

* DataFrame

**Description**

* Calculate **total revenue per brand**:

  ```
  revenue = units_sold * price
  ```
* Return **top N brands sorted by revenue (descending)**.
* Output must contain only:

  * maker
  * total_revenue

**Function Signature**

```python
def top_n_brands_by_revenue(df: DataFrame, n: int) -> DataFrame:
```

**Expected Output**

```
maker     | total_revenue
-------------------------
Toyota    | 240000000
Ford      | 195000000
```

---

### **4. Function: calculate_vehicle_age_bucket**

**Parameters**

* df: DataFrame
* reference_year: int

**Returns**

* DataFrame

**Description**

* Add a new column `age_bucket`:

  | Vehicle Age | Bucket |
  | ----------- | ------ |
  | 0â€“3 years   | NEW    |
  | 4â€“7 years   | MID    |
  | >7 years    | OLD    |

**Function Signature**

```python
def calculate_vehicle_age_bucket(df: DataFrame, reference_year: int) -> DataFrame:
```

---

### **5. Function: most_sold_model_per_brand**

**Parameters**

* df: DataFrame

**Returns**

* DataFrame

**Description**

* For each `maker`, find the **model with highest units_sold**.
* Use **Window Functions**.
* Output columns:

  * maker
  * model
  * units_sold

**Function Signature**

```python
def most_sold_model_per_brand(df: DataFrame) -> DataFrame:
```

---

### **6. Function: inactive_low_performance_models**

**Parameters**

* df: DataFrame
* min_units: int
* min_mileage: float

**Returns**

* DataFrame

**Description**

* Return vehicles where:

  * status = "inactive"
  * units_sold < min_units
  * mileage < min_mileage

**Function Signature**

```python
def inactive_low_performance_models(
    df: DataFrame,
    min_units: int,
    min_mileage: float
) -> DataFrame:
```

---

### **7. Function: list_unique_makers_sorted**

**Parameters**

* df: DataFrame

**Returns**

* List[str]

**Description**

* Return a **sorted list of unique makers**
* Must use:

  * `distinct`
  * `rdd.flatMap`

**Function Signature**

```python
def list_unique_makers_sorted(df: DataFrame) -> List[str]:
```

---

