
---

# üè• Case Study: Hospital Appointment & Wait Time Analytics (PySpark)

---

## üîç Problem Statement

You are provided with **hospital appointment data** containing information about:

* Patient appointments
* Doctors
* Scheduled vs actual consultation times
* Delay reasons

You are required to analyze **appointment delays and doctor efficiency** using **PySpark DataFrames**.

All operations must be implemented as **pure, independent functions** with clear business rules.

---

## üìå Input Data Schema (Inline)

| Column Name       | Description                    |
| ----------------- | ------------------------------ |
| appointment_id    | Unique appointment ID          |
| patient_name      | Patient name                   |
| doctor_name       | Doctor assigned                |
| department        | Hospital department            |
| scheduled_time    | Scheduled appointment time     |
| actual_start_time | Actual consultation start time |
| delay_reason      | Reason for delay               |

---

## ‚ö†Ô∏è Business Rules

* Delay must be **non-negative**
* Delay must be calculated in **minutes**
* Inline data only (no file I/O)
* Each function must be **independently testable**
* No mutation of input DataFrames

---

# üéØ Overall Processing Flow

```text
Load Inline Appointment Data
        ‚Üì
Compute Appointment Delay (minutes)
        ‚Üì
Filter Significantly Delayed Appointments
        ‚Üì
Doctor-wise & Department-wise Analysis
        ‚Üì
Identify Bottlenecks & Delay Patterns
```

---

# üß© Questions (10 Functions to Implement)

---

## ‚úÖ Q1. Load Inline Appointment Data

### Function Name

`load_inline_appointments`

### Purpose

Create a PySpark DataFrame using inline appointment records.

---

## ‚úÖ Q2. Compute Appointment Delay

### Function Name

`compute_appointment_delay`

### Purpose

Calculate delay in **minutes** between scheduled and actual start times.

### Output

Add a new column: `delay_minutes`

---

## ‚úÖ Q3. Get Delayed Appointments Beyond Threshold

### Function Name

`get_delayed_appointments`

### Purpose

Filter appointments where delay exceeds a given threshold.

---

## ‚úÖ Q4. Find Doctor with Highest Total Delay

### Function Name

`most_delayed_doctor`

### Purpose

Identify the doctor whose appointments caused the **highest total delay**.

---

## ‚úÖ Q5. Find Department with Highest Average Delay

### Function Name

`most_delayed_department`

### Purpose

Determine which department has the **highest average appointment delay**.

---

## ‚úÖ Q6. Find Most Common Delay Reason (By Count)

### Function Name

`most_frequent_delay_reason`

### Purpose

Identify the delay reason that occurs most frequently.

---

## ‚úÖ Q7. Find Delay Reason with Highest Average Delay

### Function Name

`delay_reason_with_max_avg_delay`

### Purpose

Determine which delay reason causes the **maximum average delay**.

---

## ‚úÖ Q8. Doctor-wise Average Delay

### Function Name

`doctor_avg_delay`

### Purpose

Compute average delay per doctor.

---

## ‚úÖ Q9. Peak Delay Hour Analysis

### Function Name

`peak_delay_hour`

### Purpose

Find the hour of the day during which **maximum average delays** occur.

---

## ‚úÖ Q10. Identify Efficient Doctors

### Function Name

`efficient_doctors`

### Purpose

Return doctors whose **average delay is below a given threshold**.

---

# üìä Summary Table ‚Äì Questions Overview

| Q.No | Function Name                   | Business Purpose  |
| ---- | ------------------------------- | ----------------- |
| 1    | load_inline_appointments        | Create dataset    |
| 2    | compute_appointment_delay       | Compute delay     |
| 3    | get_delayed_appointments        | Filter delayed    |
| 4    | most_delayed_doctor             | Worst performer   |
| 5    | most_delayed_department         | Dept bottleneck   |
| 6    | most_frequent_delay_reason      | Common issue      |
| 7    | delay_reason_with_max_avg_delay | Severe issue      |
| 8    | doctor_avg_delay                | Doctor efficiency |
| 9    | peak_delay_hour                 | Time bottleneck   |
| 10   | efficient_doctors               | Best performers   |

---

appointment_data = [
    ("AP001", "Rahul Sharma",  "Dr. Mehta",  "Cardiology",  "2024-05-10 09:00:00", "2024-05-10 09:20:00", "Previous Appointment Overrun"),
    ("AP002", "Anita Verma",   "Dr. Mehta",  "Cardiology",  "2024-05-10 09:30:00", "2024-05-10 10:00:00", "Emergency Case"),
    ("AP003", "Vikas Patil",   "Dr. Rao",    "Orthopedics","2024-05-10 10:00:00", "2024-05-10 10:10:00", "Late Arrival"),
    ("AP004", "Neha Joshi",    "Dr. Rao",    "Orthopedics","2024-05-10 10:30:00", "2024-05-10 11:15:00", "Equipment Issue"),
    ("AP005", "Suresh Iyer",   "Dr. Khan",   "Neurology",  "2024-05-10 11:00:00", "2024-05-10 11:45:00", "Emergency Case"),
    ("AP006", "Pooja Kulkarni","Dr. Khan",   "Neurology",  "2024-05-10 11:30:00", "2024-05-10 12:00:00", "Previous Appointment Overrun"),
    ("AP007", "Amit Deshmukh", "Dr. Mehta",  "Cardiology", "2024-05-10 12:00:00", "2024-05-10 12:40:00", "Emergency Case"),
    ("AP008", "Kiran Naik",    "Dr. Shah",   "Dermatology","2024-05-10 13:00:00", "2024-05-10 13:05:00", "Late Arrival"),
    ("AP009", "Sneha Kulkarni","Dr. Shah",   "Dermatology","2024-05-10 13:30:00", "2024-05-10 13:50:00", "Previous Appointment Overrun"),
    ("AP010", "Rohit Pawar",   "Dr. Rao",    "Orthopedics","2024-05-10 14:00:00", "2024-05-10 15:00:00", "Emergency Case")
]

